System.register(["jimu-core","jimu-ui"],(function(e,t){var a={},s={};return{setters:[function(e){a.React=e.React},function(e){s.Button=e.Button,s.Input=e.Input,s.Label=e.Label}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=a},321:e=>{"use strict";e.exports=s}},t={};function o(a){var s=t[a];if(void 0!==s)return s.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{__set_webpack_public_path__:()=>i,default:()=>s});var e=o(244),t=o(321),a=function(e,t,a,s){return new(a||(a=Promise))((function(o,n){function i(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,r)}l((s=s.apply(e,t||[])).next())}))};class s extends e.React.PureComponent{constructor(e){super(e),this.baseUrl="https://geoprocessamento.bombeiros.mg.gov.br/server/rest/services/Calculadora/GPServer",this.uploadUrl=`${this.baseUrl}/uploads/upload`,this.gpUrl=`${this.baseUrl}/Calculadora/submitJob`,this.handleUpload=(e,t)=>a(this,void 0,void 0,(function*(){const a=e.target.files[0];if(!a)return;this.setState({loading:!0,status:`Enviando ${t}...`});const s=new FormData;s.append("file",a),s.append("f","json");try{const e=yield fetch(this.uploadUrl,{method:"POST",body:s}),a=yield e.json();a.success?this.setState({[t]:a.item.itemID,loading:!1,status:`Sucesso: ${t} pronto.`}):this.setState({loading:!1,status:`Erro no servidor ao receber ${t}.`})}catch(e){this.setState({loading:!1,status:"Falha na conex\xe3o de upload."})}})),this.executeGP=()=>a(this,void 0,void 0,(function*(){const{Nir_Antes:e,SWIR_Antes:t,Nir_Depois:a,SWIR_Depois:s}=this.state;if(!(e&&t&&a&&s))return void this.setState({status:"Selecione os 4 arquivos .tif primeiro!"});this.setState({loading:!0,status:"Processando dNBR... Aguarde."});const o=new URLSearchParams;o.append("f","json"),o.append("Nir_Antes",JSON.stringify({itemID:e})),o.append("SWIR_Antes",JSON.stringify({itemID:t})),o.append("Nir_Depois",JSON.stringify({itemID:a})),o.append("SWIR_Depois",JSON.stringify({itemID:s}));try{const e=yield fetch(this.gpUrl,{method:"POST",body:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}),t=yield e.json();t.jobId?(this.setState({status:`C\xe1lculo iniciado! ID do Trabalho: ${t.jobId}`}),this.checkJobStatus(t.jobId)):this.setState({loading:!1,status:"Erro ao iniciar processamento."})}catch(e){this.setState({loading:!1,status:"Erro de comunica\xe7\xe3o com o GP."})}})),this.checkJobStatus=e=>a(this,void 0,void 0,(function*(){const t=`${this.baseUrl}/Calculadora/jobs/${e}?f=json`,s=setInterval((()=>a(this,void 0,void 0,(function*(){const e=yield fetch(t),a=yield e.json();"esriJobSucceeded"===a.jobStatus?(clearInterval(s),this.setState({loading:!1,status:"Sucesso! O dNBR foi gerado e salvo."})):"esriJobFailed"===a.jobStatus&&(clearInterval(s),this.setState({loading:!1,status:"O processamento falhou no servidor."}))}))),3e3)})),this.state={Nir_Antes:null,SWIR_Antes:null,Nir_Depois:null,SWIR_Depois:null,loading:!1,status:"Servidor Conectado. Aguardando arquivos..."}}render(){return e.React.createElement("div",{className:"p-3",style:{background:"#fff",height:"100%",overflow:"auto"}},e.React.createElement("h6",{className:"text-primary mb-3"},"Calculadora dNBR - CBMMG"),e.React.createElement("hr",null),e.React.createElement("div",{className:"mb-2"},e.React.createElement(t.Label,{size:"sm"},"NIR Antes (B8)"),e.React.createElement(t.Input,{type:"file",onChange:e=>this.handleUpload(e,"Nir_Antes")})),e.React.createElement("div",{className:"mb-2"},e.React.createElement(t.Label,{size:"sm"},"SWIR Antes (B12)"),e.React.createElement(t.Input,{type:"file",onChange:e=>this.handleUpload(e,"SWIR_Antes")})),e.React.createElement("div",{className:"mb-2"},e.React.createElement(t.Label,{size:"sm"},"NIR Depois (B8)"),e.React.createElement(t.Input,{type:"file",onChange:e=>this.handleUpload(e,"Nir_Depois")})),e.React.createElement("div",{className:"mb-3"},e.React.createElement(t.Label,{size:"sm"},"SWIR Depois (B12)"),e.React.createElement(t.Input,{type:"file",onChange:e=>this.handleUpload(e,"SWIR_Depois")})),e.React.createElement(t.Button,{className:"w-100 mt-2",type:"primary",onClick:this.executeGP,disabled:this.state.loading},this.state.loading?"Processando...":"Calcular e Salvar"),e.React.createElement("div",{className:"mt-3 p-2 bg-light border small text-center rounded"},e.React.createElement("strong",null,"Status:"),e.React.createElement("br",null),this.state.status))}}function i(e){o.p=e}})(),n})())}}}));